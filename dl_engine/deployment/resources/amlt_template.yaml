environment:
  image: yuxiaoguo/mercury:latest
  setup:
    - pip install -r requirements.txt
    - export MERCURY_DATA_ROOT=/mnt/input/datasets
    - export MERCURY_MODEL_ZOO=/mnt/input/projects/mercury/ModelZoo
    - export PYTHONUNBUFFERED=0
  # image: yuxiaoguo/torch112-cu113-stratified:latest
  # image: yyq465009551/torch112_cu113:torch112_spl_ak
  # image: amlt-sing/pytorch-1.11.0-cuda11.6:20220610T172305953
  # image: amlt-sing/pytorch-1.11.0
  # image_setup:
  #   - apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/3bf863cc.pub
  #   - apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64/7fa2af80.pub
  #   - apt-get update -y
  #   - DEBIAN_FRONTEND=noninteractive && apt-get install -y libibverbs1 ibverbs-providers
  #   - apt-get install -y ffmpeg libsm6 libxext6 libopenblas-dev
  # setup:
  #   - export CUDA_LAUNCH_BLOCKING=1
  #   - export PYTORCH_NO_CUDA_MEMORY_CACHING=1
  #   - pip install -r requirements.txt
  #   - export TORCH_CUDA_ARCH_LIST="7.0 7.5 8.0" && cd SparseFormerLib && python setup.py install --user
  #   - pip list

code:
  local_dir: .

storage:
  input: 
    storage_account_name: igsharestorage
    container_name: yuxgu

data:
  storage_id: input